<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Zen - v22.0 Match Start</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="words.js" onerror="console.log('Local words.js not found')"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        
        :root { --glass: blur(20px) saturate(180%); }
        body { 
            font-family: 'Outfit', 'Noto Sans SC', sans-serif; 
            color: #334155; overflow: hidden; background-color: #f3f4f6;
            background-image: 
                radial-gradient(at 0% 0%, rgba(224, 231, 255, 0.9) 0, transparent 55%),
                radial-gradient(at 100% 0%, rgba(243, 232, 255, 0.9) 0, transparent 55%),
                radial-gradient(at 50% 100%, rgba(252, 231, 243, 0.9) 0, transparent 60%);
            background-attachment: fixed; background-size: cover;
        }
        
        .glass-panel { background: rgba(255, 255, 255, 0.65); backdrop-filter: var(--glass); -webkit-backdrop-filter: var(--glass); border: 1px solid rgba(255, 255, 255, 0.4); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); box-shadow: 0 10px 40px -10px rgba(79, 70, 229, 0.1); border: 1px solid rgba(255, 255, 255, 0.6); }
        .nav-active { background-color: rgba(255, 255, 255, 0.9); color: #4f46e5; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); font-weight: 700; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* --- 3D ÁøªËΩ¨ --- */
        .flip-container { perspective: 1000px; width: 100%; height: 100%; }
        .flipper { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flipper.flipped { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 1.5rem; overflow: hidden; background: white; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .front { z-index: 2; transform: rotateY(0deg); }
        .back { transform: rotateY(180deg); }

        /* --- Â°´Á©∫Ê†∑Âºè --- */
        #sent-container { line-height: 2.2; font-size: 1.25rem; color: #334155; }
        .cloze-input { border: none; border-bottom: 2px solid #6366f1; background: rgba(99, 102, 241, 0.05); color: #4f46e5; font-weight: 700; font-size: 1.25rem; text-align: center; padding: 0 4px; margin: 0 4px; outline: none; transition: all 0.3s; display: inline-block; font-family: inherit; }
        .cloze-input:focus { border-bottom-width: 3px; background: rgba(99, 102, 241, 0.15); }
        .cloze-input.correct { border-color: #10b981; color: #047857; background: #d1fae5; }
        .cloze-input.wrong { border-color: #f43f5e; color: #be123c; background: #ffe4e6; animation: shake 0.4s; }
        .cloze-input.revealed { border-color: #f59e0b; color: #b45309; background: #fef3c7; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-spin-slow { animation: spin 15s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* --- ËøûËøûÁúãÊ†∑Âºè --- */
        .pop-out { animation: popOut 0.4s forwards; } 
        @keyframes popOut { to { opacity: 0; transform: scale(0); } }
        .match-card { background-color: white; color: #475569; border: 1px solid #e2e8f0; transition: all 0.2s; }
        .match-card:hover { border-color: #6366f1; transform: translateY(-2px); }
        .match-card.selected { background-color: #4f46e5 !important; color: white !important; border-color: #4338ca !important; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.3); transform: scale(1.05); }
        .match-card.wrong { background-color: #f43f5e !important; color: white !important; border-color: #e11d48 !important; animation: shake 0.4s; }

        /* --- ÂºπÁ™óÊ†∑Âºè --- */
        #modal-overlay { background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(8px); transition: opacity 0.3s; pointer-events: none; opacity: 0; }
        #modal-overlay.active { pointer-events: auto; opacity: 1; }
        #modal-content { transform: scale(0.95); opacity: 0; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        #modal-overlay.active #modal-content { transform: scale(1); opacity: 1; }
    </style>
</head>
<body class="flex h-screen w-screen">

    <aside class="w-64 h-full glass-panel border-r-0 flex flex-col flex-shrink-0 z-50">
        <div class="p-8 pb-6">
            <div class="flex items-center gap-2 text-indigo-600 mb-1">
                <div class="p-1.5 bg-indigo-600 rounded-lg shadow-sm"><i data-lucide="zap" class="w-5 h-5 text-white"></i></div>
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-800">IELTS Zen</h1>
            </div>
            <p class="text-[10px] text-slate-500 pl-10 font-medium tracking-wide">v22.0 Match Start</p>
        </div>
        <nav class="flex-1 px-4 space-y-2">
            <button onclick="app.nav('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>È¶ñÈ°µÊ¶ÇËßà</span></button>
            <button onclick="app.nav('study')" id="nav-study" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="layers" class="w-5 h-5"></i><span>ËÉåÂçïËØç</span></button>
            <button onclick="app.nav('sentence')" id="nav-sentence" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="pen-tool" class="w-5 h-5"></i><span>ÊãºÂÜôÂ°´Á©∫</span></button>
            <button onclick="app.nav('quiz')" id="nav-quiz" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="trophy" class="w-5 h-5"></i><span>ÊåëÊàòÊ®°Âºè</span></button>
            <button onclick="app.nav('match')" id="nav-match" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="grid" class="w-5 h-5"></i><span>ËøûËøûÁúã</span></button>
            <button onclick="app.nav('list')" id="nav-list" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-white/40 transition-all font-medium"><i data-lucide="book" class="w-5 h-5"></i><span>ËØçÊ±áË°®</span></button>
            
            <div class="pt-6 mt-6 border-t border-slate-200/50">
                <p class="px-4 text-[10px] uppercase text-slate-400 font-bold mb-2">Data</p>
                <button onclick="app.nav('import')" id="nav-import" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-500 hover:bg-indigo-50 hover:text-indigo-600 transition-all font-medium"><i data-lucide="upload-cloud" class="w-5 h-5"></i><span>Êõ¥Êñ∞ËØçÂ∫ì</span></button>
                <button onclick="app.resetData()" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-rose-400 hover:bg-rose-50 hover:text-rose-600 transition-all font-medium text-xs"><i data-lucide="trash" class="w-4 h-4"></i><span>ÈáçÁΩÆ</span></button>
            </div>
        </nav>
        
        <div class="p-4">
            <div class="relative overflow-hidden bg-gradient-to-br from-violet-600 to-indigo-900 rounded-xl p-5 text-white shadow-xl group cursor-default">
                <div class="relative z-10">
                    <p class="text-[10px] font-bold opacity-70 uppercase tracking-widest mb-1 flex items-center gap-2"><i data-lucide="database" class="w-3 h-3"></i> Total Words</p>
                    <div class="flex items-baseline justify-between mt-2"><span class="text-3xl font-extrabold tracking-tight" id="sidebar-count">0</span></div>
                </div>
                <i data-lucide="dna" class="absolute -right-4 -bottom-4 w-24 h-24 text-white opacity-10 animate-spin-slow"></i>
                <div class="absolute top-0 right-0 w-16 h-16 bg-white opacity-5 rounded-full blur-2xl -mr-8 -mt-8"></div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative overflow-hidden">
        <header class="h-20 px-10 flex items-center justify-between flex-shrink-0">
            <h2 id="page-title" class="text-2xl font-bold text-slate-800 tracking-tight">Dashboard</h2>
            <div class="flex gap-4"><div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 text-sm font-bold text-indigo-600 shadow-sm border border-white/50"><i data-lucide="server" class="w-4 h-4"></i><span id="db-source">Checking...</span></div></div>
        </header>

        <div class="flex-1 overflow-y-auto p-10 pt-0">
            <div id="view-dashboard" class="view-section max-w-5xl mx-auto space-y-8 hidden fade-in">
                <div class="w-full h-48 rounded-3xl bg-gradient-to-r from-indigo-500 to-purple-600 shadow-xl flex items-center px-10 relative overflow-hidden text-white">
                    <div class="z-10"><h1 class="text-3xl font-bold mb-2">Welcome!</h1><p class="text-indigo-100 max-w-lg mb-6">Let's learn something new.</p><button onclick="app.nav('study')" class="bg-white text-indigo-600 px-6 py-2 rounded-lg font-bold hover:scale-105 transition-transform shadow-lg flex items-center gap-2">Start Review <i data-lucide="arrow-right" class="w-4 h-4"></i></button></div>
                    <i data-lucide="target" class="absolute -right-6 -bottom-10 w-64 h-64 text-white opacity-10 rotate-12"></i>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-card p-6 rounded-2xl text-center"><h3 class="text-3xl font-bold text-slate-800" id="dash-learned-today">0</h3><p class="text-slate-500 text-sm">Today</p></div>
                    <div class="glass-card p-6 rounded-2xl text-center"><h3 class="text-3xl font-bold text-slate-800" id="dash-highscore">0</h3><p class="text-slate-500 text-sm">Best Score</p></div>
                    <div class="glass-card p-6 rounded-2xl text-center"><h3 class="text-3xl font-bold text-slate-800" id="dash-total">0</h3><p class="text-slate-500 text-sm">Total</p></div>
                </div>
            </div>

            <div id="view-study" class="view-section h-full flex flex-col items-center justify-center max-w-xl mx-auto -mt-10 hidden">
                <div class="w-full mb-6 glass-panel p-4 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-3"><div class="p-2 bg-indigo-100 text-indigo-600 rounded-lg"><i data-lucide="flag" class="w-4 h-4"></i></div><div><p class="text-xs text-slate-500 font-bold uppercase">Daily Goal</p><p class="text-sm font-bold text-slate-800"><span id="daily-current">0</span> / <span id="daily-target">20</span></p></div></div>
                    <button onclick="app.setDailyGoal()" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold">Edit</button>
                </div>
                <div class="flip-container w-full aspect-[4/5] max-h-[550px]">
                    <div class="flipper" id="card-inner">
                        <div class="front cursor-pointer" onclick="app.flipCard()">
                            <div class="h-1.5 w-full bg-slate-100 absolute top-0 left-0"><div class="h-full bg-indigo-500 w-0 transition-all duration-300" id="progress-bar"></div></div>
                            <div class="flex-1 flex flex-col items-center justify-center">
                                <span class="inline-block px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full text-xs font-bold tracking-wider mb-8 uppercase">Flashcard</span>
                                <h1 id="card-word" class="text-5xl lg:text-6xl font-extrabold text-slate-800 mb-6 tracking-tight text-center px-4">Loading</h1>
                                <button onclick="app.speak(event)" class="group flex items-center gap-2 px-5 py-2.5 rounded-full bg-slate-50 text-slate-500 border border-slate-200 shadow-sm hover:border-indigo-200 hover:text-indigo-600 mt-4"><i data-lucide="volume-2" class="w-5 h-5"></i><span id="card-phonetic" class="font-mono text-sm"></span></button>
                                <p class="absolute bottom-6 text-xs text-slate-400 animate-pulse">Tap to flip</p>
                            </div>
                        </div>
                        <div class="back text-left cursor-pointer" onclick="app.flipCard()">
                            <div class="h-1.5 w-full bg-slate-100 absolute top-0 left-0"><div class="h-full bg-indigo-500 w-0 transition-all duration-300" id="progress-bar-back"></div></div>
                            <div class="flex-1 overflow-y-auto no-scrollbar p-8 pt-10">
                                <div class="flex justify-between items-start mb-6 border-b border-slate-100 pb-4">
                                    <div><h2 id="detail-word" class="text-3xl font-bold text-slate-800">...</h2><p id="detail-trans" class="text-xl text-indigo-600 font-bold mt-1">...</p></div>
                                    <button class="p-2 rounded-full bg-slate-50 text-slate-400 hover:bg-slate-100"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></button>
                                </div>
                                <div class="space-y-6">
                                    <div><p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Definition</p><p id="detail-def" class="text-slate-700 font-medium leading-relaxed">...</p></div>
                                    <div class="bg-indigo-50/50 p-4 rounded-xl border-l-4 border-indigo-400">
                                        <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">Example</p>
                                        <p id="detail-ex" class="text-slate-700 italic text-sm leading-relaxed">...</p>
                                        <p id="detail-ex-trans" class="text-slate-500 text-xs mt-2 pt-2 border-t border-indigo-200/50">...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 border-t border-slate-100 bg-slate-50/80 flex gap-4 cursor-auto" onclick="event.stopPropagation()">
                                <button onclick="app.prevCard()" class="flex-1 py-3.5 rounded-xl font-bold text-sm bg-white border border-slate-200 text-slate-600 shadow-sm hover:bg-slate-50 transition-all flex items-center justify-center gap-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> Prev</button>
                                <button onclick="app.nextCard()" class="flex-[2] py-3.5 rounded-xl font-bold text-sm bg-indigo-600 text-white shadow-lg shadow-indigo-200 hover:bg-indigo-500 transition-all flex items-center justify-center gap-2">Next Word <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-sentence" class="view-section hidden max-w-3xl mx-auto h-full flex flex-col justify-center">
                <div class="glass-card p-12 rounded-3xl relative text-center">
                    <span class="inline-block px-3 py-1 bg-emerald-50 text-emerald-600 rounded-full text-xs font-bold tracking-wider mb-8 uppercase">Sentence Craft</span>
                    <div id="sent-container" class="mb-10 text-2xl font-medium text-slate-700 leading-loose">Loading...</div>
                    <div class="text-sm text-indigo-500 font-bold mb-10 bg-indigo-50 inline-block px-4 py-2 rounded-lg border border-indigo-100 max-w-xl mx-auto">Translation: <span id="sent-trans" class="text-slate-700 font-normal">...</span></div>
                    <div class="flex justify-center gap-4">
                        <button onclick="app.checkSentence()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-500 transition-all">Check</button>
                        <button onclick="app.showAnswer()" class="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold shadow-lg hover:bg-amber-600 transition-all">Answer</button>
                        <button onclick="app.nextSentence()" class="px-6 py-3 bg-white text-slate-500 border border-slate-200 rounded-xl font-bold hover:bg-slate-50 transition-all">Skip</button>
                    </div>
                    <div id="sent-feedback" class="mt-6 font-bold h-6 text-lg"></div>
                </div>
            </div>

            <div id="view-quiz" class="view-section hidden h-full flex flex-col items-center justify-center max-w-2xl mx-auto">
                <div class="glass-card w-full p-8 rounded-3xl relative">
                    <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-100">
                        <div><span class="text-xs font-bold text-slate-400 uppercase">Progress</span><p class="text-lg font-bold text-indigo-600"><span id="quiz-idx">1</span> / <span id="quiz-total">20</span></p></div>
                        <div class="text-center"><span class="text-xs font-bold text-slate-400 uppercase">Timer</span><p class="text-xl font-mono font-bold text-slate-700" id="quiz-timer">00:00</p></div>
                        <div class="text-right"><span class="text-xs font-bold text-slate-400 uppercase">Score</span><p class="text-lg font-bold text-emerald-600" id="quiz-score">0</p></div>
                    </div>
                    <div id="quiz-container">
                        <h2 class="text-4xl font-bold text-slate-800 mb-8 text-center">Ready?</h2>
                        <button onclick="app.startQuizRun()" class="w-full p-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-500 transition-all">Start Challenge</button>
                    </div>
                    <div id="quiz-history" class="mt-8 pt-6 border-t border-slate-100 hidden">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-3">Recent Records</h4>
                        <div id="history-list" class="space-y-2 max-h-32 overflow-y-auto text-sm text-slate-600"></div>
                    </div>
                </div>
            </div>

            <div id="view-match" class="view-section hidden h-full max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-6 px-2">
                    <div class="flex items-center gap-4">
                        <button onclick="app.prepareMatchGame()" class="text-xs bg-white border border-indigo-200 text-rose-500 px-4 py-2 rounded-lg font-bold hover:bg-rose-50 shadow-sm" id="btn-match-stop">Stop</button>
                        <div class="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-slate-200">
                            <i data-lucide="timer" class="w-4 h-4 text-slate-400"></i>
                            <input type="number" id="match-duration" value="60" class="w-12 text-sm font-bold text-center text-slate-700 outline-none bg-transparent" onchange="app.saveState()" min="10" max="300">
                            <span class="text-xs text-slate-400 font-bold">s</span>
                        </div>
                        <div class="flex flex-col"><span class="text-[10px] uppercase font-bold text-slate-400">Time Left</span><div class="w-32 h-2 bg-slate-200 rounded-full overflow-hidden"><div id="game-timer-bar" class="h-full bg-orange-500 w-full transition-all duration-1000 ease-linear"></div></div></div>
                    </div>
                    <div id="combo-display" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-rose-500 opacity-0">COMBO x<span id="combo-count">0</span>!</div>
                </div>
                
                <div id="match-grid" class="grid grid-cols-4 gap-4 pb-4 select-none h-96 relative">
                    </div>
                
                <div class="mt-4 glass-card p-4 rounded-2xl max-w-lg mx-auto">
                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Match History</h4>
                    <div id="match-history-list" class="space-y-2 max-h-24 overflow-y-auto text-sm text-slate-600 no-scrollbar"><p class="text-xs text-slate-400 text-center">No records yet.</p></div>
                </div>
            </div>

            <div id="view-list" class="view-section hidden max-w-5xl mx-auto flex flex-col h-full">
                <div class="glass-card rounded-3xl overflow-hidden flex-1 flex flex-col">
                    <div class="overflow-y-auto flex-1"><table class="w-full text-left text-sm"><thead class="bg-indigo-50/50 text-slate-500 font-bold border-b border-slate-200 sticky top-0 bg-white/90 backdrop-blur"><tr><th class="p-5 pl-8">Word</th><th class="p-5">Translation</th><th class="p-5 hidden lg:table-cell">Example</th></tr></thead><tbody id="list-body" class="divide-y divide-slate-100"></tbody></table></div>
                    <div class="p-4 border-t border-slate-100 bg-white/50 backdrop-blur flex justify-between items-center text-xs">
                        <div class="flex gap-2"><button onclick="app.firstPage()" class="px-3 py-1 bg-white border rounded hover:bg-indigo-50">|&lt;</button><button onclick="app.prevPage()" class="px-3 py-1 bg-white border rounded hover:bg-slate-50">&lt; Prev</button></div>
                        <span class="font-bold text-slate-500" id="page-info">Page 1</span>
                        <div class="flex gap-2"><button onclick="app.nextPage()" class="px-3 py-1 bg-white border rounded hover:bg-slate-50">Next &gt;</button><button onclick="app.lastPage()" class="px-3 py-1 bg-white border rounded hover:bg-indigo-50">&gt;|</button></div>
                    </div>
                </div>
            </div>

            <div id="view-import" class="view-section max-w-3xl mx-auto hidden">
                <div class="glass-card p-10 rounded-3xl text-center">
                    <div class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6"><i data-lucide="file-text" class="w-8 h-8"></i></div>
                    <h2 class="text-3xl font-bold text-slate-800 mb-4">Import Data</h2>
                    <p class="text-slate-500 mb-8 max-w-md mx-auto">Upload words.js or TXT</p>
                    <div class="border-2 border-dashed border-slate-300 rounded-2xl p-10 hover:border-indigo-500 hover:bg-indigo-50/50 transition-all cursor-pointer relative">
                        <input type="file" id="file-upload" class="absolute inset-0 opacity-0 cursor-pointer" accept=".js,.json,.txt" onchange="app.handleFileUpload(event)">
                        <div class="pointer-events-none"><p class="font-bold text-slate-700 text-lg">Click to Upload</p><p class="text-sm text-slate-400 mt-2">Supports: words.js, TXT</p></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="modal-overlay" class="fixed inset-0 z-[100] flex items-center justify-center" onclick="app.closeModal(event)">
            <div id="modal-content" class="bg-white rounded-3xl shadow-2xl w-full max-w-lg mx-6 overflow-hidden relative" onclick="event.stopPropagation()">
                <button onclick="app.closeModal()" class="absolute top-4 right-4 p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 z-10"><i data-lucide="x" class="w-5 h-5"></i></button>
                <div class="p-8">
                    <div class="text-center mb-6">
                        <h2 id="modal-word" class="text-4xl font-extrabold text-slate-800 mb-2">Word</h2>
                        <span id="modal-phonetic" class="text-slate-500 font-mono text-sm bg-slate-50 px-3 py-1 rounded-full"></span>
                    </div>
                    <div class="space-y-4">
                        <div class="text-center"><p class="text-xs font-bold text-indigo-500 uppercase mb-1">Definition</p><p id="modal-def" class="text-slate-700 font-medium">...</p></div>
                        <div class="text-center"><p class="text-xs font-bold text-emerald-500 uppercase mb-1">Translation</p><p id="modal-trans" class="text-slate-700">...</p></div>
                        <div class="bg-indigo-50 p-4 rounded-xl border-l-4 border-indigo-400 mt-4">
                            <p class="text-[10px] font-bold text-indigo-400 uppercase mb-1">Context</p>
                            <p id="modal-ex" class="text-slate-700 italic text-sm">...</p>
                            <p id="modal-ext" class="text-slate-500 text-xs mt-2 pt-2 border-t border-indigo-200/50">...</p>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-50 p-4 text-center border-t border-slate-100">
                    <button onclick="app.speakWordFromModal()" class="text-indigo-600 font-bold text-sm flex items-center justify-center gap-2 hover:underline"><i data-lucide="volume-2" class="w-4 h-4"></i> Pronounce</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const app = {
            data: [], 
            state: { view: 'dashboard', index: 0, listPage: 1, dailyGoal: 20, todayLearned: 0, lastDate: null },
            quiz: { active: false, timer: null, time: 0, score: 0, current: 0, total: 20, history: [] },
            sentence: { current: null, answer: "" },
            match: { timer: null, timeLeft: 60, totalTime: 60, combo: 0, selected: null, history: [] },
            
            init() {
                if(window.IELTS_DB) { this.data = window.IELTS_DB; document.getElementById('db-source').innerText = "Using words.js"; }
                else if(localStorage.getItem('ielts_db')) { try{this.data=JSON.parse(localStorage.getItem('ielts_db')); document.getElementById('db-source').innerText="Using Cache";}catch(e){this.loadDemo();} }
                else { this.loadDemo(); }

                const s = JSON.parse(localStorage.getItem('ielts_user_state')||'{}');
                const t = new Date().toDateString();
                this.state.dailyGoal = s.dailyGoal||20; 
                this.quiz.history = s.quizHistory||[];
                this.match.history = s.matchHistory||[];
                this.match.totalTime = s.matchDuration || 60;
                
                this.state.todayLearned = (s.lastDate===t)?(s.todayLearned||0):0;
                this.state.lastDate = t;
                
                document.getElementById('match-duration').value = this.match.totalTime;
                
                this.updateStats(); this.nav('dashboard'); this.renderIcons();
            },
            
            loadDemo() { this.data = [{w:"Welcome", t:"Ê¨¢Ëøé", p:"", d:"Please upload words.js", e:"Welcome to IELTS Zen.", e_t:"Ê¨¢Ëøé„ÄÇ"}]; document.getElementById('db-source').innerText = "Demo Mode"; },
            
            saveState() { 
                const durationInput = document.getElementById('match-duration');
                if(durationInput) this.match.totalTime = parseInt(durationInput.value) || 60;

                localStorage.setItem('ielts_user_state', JSON.stringify({ 
                    dailyGoal:this.state.dailyGoal, 
                    todayLearned:this.state.todayLearned, 
                    lastDate:this.state.lastDate, 
                    quizHistory:this.quiz.history,
                    matchHistory:this.match.history,
                    matchDuration:this.match.totalTime 
                })); 
                this.updateStats(); 
            },

            nav(view) {
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
                document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('nav-active', 'bg-white', 'text-indigo-600'); el.classList.add('text-slate-500'); });
                document.getElementById(`nav-${view}`).classList.remove('text-slate-500');
                document.getElementById(`nav-${view}`).classList.add('nav-active', 'bg-white', 'text-indigo-600');
                
                if(view==='study') this.loadCard(); 
                if(view==='list') this.renderList(); 
                if(view==='sentence') this.nextSentence(); 
                if(view==='quiz') this.resetQuizUI();
                if(view==='match') { this.renderMatchHistory(); this.prepareMatchGame(); }
            },

            // --- ËÉåÂçïËØç ---
            loadCard() {
                const w = this.data[this.state.index % this.data.length];
                document.getElementById('card-inner').classList.remove('flipped'); 
                document.getElementById('card-word').innerText = w.w;
                document.getElementById('card-phonetic').innerText = w.p||"";
                document.getElementById('detail-word').innerText = w.w;
                document.getElementById('detail-trans').innerText = w.t||"";
                document.getElementById('detail-def').innerText = w.d||"No definition";
                document.getElementById('detail-ex').innerText = w.e?`"${w.e}"`:"No example";
                document.getElementById('detail-ex-trans').innerText = w.e_t||"";
                const pct = `${((this.state.index%this.data.length)/this.data.length)*100}%`;
                document.getElementById('progress-bar').style.width = pct;
                document.getElementById('progress-bar-back').style.width = pct;
                document.getElementById('daily-current').innerText = this.state.todayLearned;
                document.getElementById('daily-target').innerText = this.state.dailyGoal;
            },
            flipCard() { document.getElementById('card-inner').classList.toggle('flipped'); },
            nextCard() { this.state.todayLearned++; if(this.state.todayLearned===this.state.dailyGoal) confetti(); this.saveState(); this.state.index++; this.loadCard(); },
            prevCard() { if(this.state.index>0) this.state.index--; this.loadCard(); }, 

            // --- ÊãºÂÜôÂ°´Á©∫ ---
            nextSentence() {
                let w, i=0; do{ w=this.data[Math.floor(Math.random()*this.data.length)]; i++; }while((!w.e||w.e.length<10)&&i<200);
                if(!w.e) return document.getElementById('sent-container').innerText="No suitable examples found.";
                this.sentence.answer = w.w.toLowerCase();
                const regex = new RegExp(`\\b${w.w}\\w*`, 'gi');
                let found=false;
                let html = w.e.replace(regex, m => { found=true; return `<input type="text" id="inline-input" class="cloze-input" style="width:${Math.max(80, m.length*16)}px" autocomplete="off">`; });
                if(!found) return this.nextSentence(); 
                document.getElementById('sent-container').innerHTML = html;
                document.getElementById('sent-trans').innerText = w.e_t || w.t;
                document.getElementById('sent-feedback').innerText = "";
                setTimeout(()=>{const inp=document.getElementById('inline-input'); if(inp){inp.focus(); inp.onkeydown=e=>{if(e.key==='Enter')this.checkSentence()}}},100);
            },
            checkSentence() {
                const inp = document.getElementById('inline-input'); if(!inp) return;
                const v = inp.value.trim().toLowerCase();
                if(v && (v===this.sentence.answer || this.sentence.answer.startsWith(v) || v.startsWith(this.sentence.answer))) {
                    inp.classList.add('correct'); document.getElementById('sent-feedback').innerText="‚ú® Correct!"; document.getElementById('sent-feedback').className="mt-6 font-bold h-6 text-emerald-500"; confetti({particleCount:30,origin:{y:0.6}}); setTimeout(()=>this.nextSentence(),1500);
                } else { 
                    inp.classList.add('wrong'); setTimeout(()=>inp.classList.remove('wrong'),500); document.getElementById('sent-feedback').innerText="‚ùå Try again"; document.getElementById('sent-feedback').className="mt-6 font-bold h-6 text-rose-500";
                }
            },
            showAnswer() { const inp=document.getElementById('inline-input'); if(!inp)return; inp.value=this.sentence.answer; inp.classList.add('revealed'); inp.focus(); },

            // --- ËøûËøûÁúã (Â¢ûÂä† Start ÊåâÈíÆ) ---
            prepareMatchGame() {
                clearInterval(this.match.timer);
                document.getElementById('match-grid').innerHTML = `
                    <div class="col-span-4 flex flex-col items-center justify-center h-64 animate-in fade-in zoom-in duration-300">
                        <div class="p-4 rounded-full bg-indigo-100 text-indigo-600 mb-4"><i data-lucide="gamepad-2" class="w-8 h-8"></i></div>
                        <h3 class="text-xl font-bold text-slate-700 mb-2">Ready to Match?</h3>
                        <p class="text-slate-500 mb-6 text-sm">Find pairs as fast as you can!</p>
                        <button onclick="app.startMatchGame()" class="px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-500 transition-all flex items-center gap-2">
                            <i data-lucide="play"></i> Start Game
                        </button>
                    </div>
                `;
                lucide.createIcons();
            },

            startMatchGame() {
                clearInterval(this.match.timer); 
                const durationInput = document.getElementById('match-duration');
                this.match.totalTime = parseInt(durationInput.value) || 60;
                this.match.timeLeft = this.match.totalTime;
                
                this.match.combo = 0; this.match.selected = null;
                document.getElementById('combo-display').classList.add('opacity-0');
                
                const grid = document.getElementById('match-grid'); grid.innerHTML = '';
                const subset = []; for(let k=0; k<8; k++) subset.push(this.data[Math.floor(Math.random()*this.data.length)]);
                let cards = []; subset.forEach((w, i) => { cards.push({id: i, txt: w.w, type: 'en'}); cards.push({id: i, txt: w.t, type: 'cn'}); });
                cards.sort(() => Math.random() - 0.5);
                
                cards.forEach(c => {
                    const el = document.createElement('div');
                    el.className = "p-2 rounded-xl flex items-center justify-center text-center font-bold cursor-pointer h-24 text-sm overflow-hidden match-card";
                    el.innerText = c.txt; el.onclick = () => this.handleMatchClick(el, c); grid.appendChild(el);
                });
                
                this.match.timer = setInterval(() => { 
                    this.match.timeLeft--; 
                    const pct = (this.match.timeLeft / this.match.totalTime) * 100;
                    document.getElementById('game-timer-bar').style.width = `${pct}%`; 
                    if(this.match.timeLeft <= 0) this.endMatchGame(false); 
                }, 1000);
            },
            
            handleMatchClick(el, c) {
                if(el.classList.contains('opacity-0')) return; 
                
                if(!this.match.selected) { 
                    this.match.selected = {el, c}; 
                    el.classList.add('selected'); 
                } 
                else {
                    if(this.match.selected.c.id === c.id && this.match.selected.c.type !== c.type) { 
                        // Match
                        el.classList.add('pop-out'); this.match.selected.el.classList.add('pop-out'); 
                        this.match.combo++; 
                        document.getElementById('combo-count').innerText=this.match.combo; 
                        document.getElementById('combo-display').classList.remove('opacity-0'); 
                        const remaining = document.querySelectorAll('.match-card:not(.pop-out)').length;
                        if (remaining <= 2) setTimeout(() => this.endMatchGame(true), 500); 
                    } 
                    else { 
                        // Wrong
                        el.classList.add('wrong'); this.match.selected.el.classList.add('wrong'); 
                        const saved1 = this.match.selected.el; const saved2 = el;
                        setTimeout(() => { saved1.classList.remove('wrong','selected'); saved2.classList.remove('wrong','selected'); }, 500); 
                    }
                    this.match.selected = null;
                }
            },

            endMatchGame(win) {
                clearInterval(this.match.timer);
                if (win) { confetti({ particleCount: 200, spread: 100 }); alert(`üèÜ Victory! Time left: ${this.match.timeLeft}s`); } 
                else { alert("‚è∞ Time's Up!"); }
                
                const record = {
                    date: new Date().toLocaleTimeString(),
                    result: win ? "Win" : "Fail",
                    pairs: this.match.combo,
                    time: `${this.match.totalTime - this.match.timeLeft}s / ${this.match.totalTime}s`
                };
                this.match.history.unshift(record);
                if(this.match.history.length > 10) this.match.history.pop();
                this.saveState();
                this.renderMatchHistory();
                this.prepareMatchGame(); // Return to start screen
            },

            renderMatchHistory() {
                const list = document.getElementById('match-history-list');
                if(!this.match.history.length) return;
                list.innerHTML = this.match.history.map(h => `
                    <div class="flex justify-between items-center bg-slate-50 p-2 rounded border border-slate-100">
                        <span class="text-xs text-slate-400">${h.date}</span>
                        <span class="font-bold ${h.result==='Win'?'text-emerald-500':'text-rose-500'} text-xs">${h.result}</span>
                        <span class="text-xs text-indigo-600 font-bold">${h.pairs} Pairs</span>
                        <span class="font-mono text-xs text-slate-500">${h.time}</span>
                    </div>
                `).join('');
            },

            // --- ÂÖ∂‰ªñ ---
            renderList(){ const s=(this.state.listPage-1)*100; const max=Math.ceil(this.data.length/100); document.getElementById('list-body').innerHTML=this.data.slice(s,s+100).map((w,i)=>`<tr class="hover:bg-indigo-50/40 cursor-pointer" onclick="app.openModal(${s+i})"><td class="p-4 font-bold text-slate-700">${w.w}</td><td class="p-4 text-slate-500">${w.t}</td><td class="p-4 text-xs italic text-slate-400 group relative"><span class="opacity-0 group-hover:opacity-100 absolute right-4 text-indigo-500 font-bold transition-opacity">View -></span>${w.e?w.e.substring(0,40)+'...':''}</td></tr>`).join(''); document.getElementById('page-info').innerText=`Page ${this.state.listPage} of ${max}`; },
            nextPage(){ if(this.state.listPage<Math.ceil(this.data.length/100)){this.state.listPage++; this.renderList();} }, 
            prevPage(){ if(this.state.listPage>1){this.state.listPage--; this.renderList();} },
            firstPage(){ this.state.listPage=1; this.renderList(); },
            lastPage(){ this.state.listPage=Math.ceil(this.data.length/100); this.renderList(); },
            openModal(i){ const w=this.data[i]; document.getElementById('modal-word').innerText=w.w; document.getElementById('modal-phonetic').innerText=w.p||""; document.getElementById('modal-def').innerText=w.d||"-"; document.getElementById('modal-trans').innerText=w.t||""; document.getElementById('modal-ex').innerText=w.e||"-"; document.getElementById('modal-ext').innerText=w.e_t||""; document.getElementById('modal-overlay').classList.add('active'); },
            closeModal(e){ if(!e||e.target.id==='modal-overlay'||e.target.tagName==='BUTTON') document.getElementById('modal-overlay').classList.remove('active'); },
            speakWordFromModal(){ const t=document.getElementById('modal-word').innerText; const u=new SpeechSynthesisUtterance(t); u.lang='en-GB'; window.speechSynthesis.speak(u); },
            handleFileUpload(e){ const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=ev=>{ try{ if(f.name.endsWith('.js'))this.data=JSON.parse(ev.target.result.substring(ev.target.result.indexOf('['),ev.target.result.lastIndexOf(']')+1)); else this.data=ev.target.result.split('\n').map(l=>{let m=l.trim().match(/^(\S+)\s+(\[.*?\])?\s*(.*)$/); return m?{w:m[1],p:m[2]||"",t:m[3]||"",d:"",e:"",e_t:""}:null}).filter(i=>i); localStorage.setItem('ielts_db', JSON.stringify(this.data)); alert("Success!"); location.reload(); }catch{alert("Format Error");} }; r.readAsText(f); },
            setDailyGoal(){ const n=prompt("Target:",this.state.dailyGoal); if(n){this.state.dailyGoal=parseInt(n); this.saveState(); this.loadCard();} },
            updateStats(){ document.getElementById('sidebar-count').innerText=this.data.length; document.getElementById('dash-total').innerText=this.data.length; document.getElementById('dash-learned-today').innerText=this.state.todayLearned; document.getElementById('dash-highscore').innerText=this.quiz.history.length>0?Math.max(...this.quiz.history.map(r=>r.score)):0; },
            resetQuizUI(){ document.getElementById('quiz-container').innerHTML=`<h2 class="text-4xl font-bold text-slate-800 mb-8 text-center">Ready?</h2><button onclick="app.startQuizRun()" class="w-full p-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg hover:bg-indigo-500 transition-all">Start Challenge</button>`; document.getElementById('quiz-history').classList.remove('hidden'); document.getElementById('history-list').innerHTML=this.quiz.history.map(h=>`<div class="flex justify-between p-2 border-b text-xs text-slate-600"><span>${h.date.split(' ')[0]}</span><b>${h.score}</b></div>`).join(''); },
            startQuizRun(){ this.quiz.active=true; this.quiz.score=0; this.quiz.current=0; this.quiz.time=0; document.getElementById('quiz-history').classList.add('hidden'); clearInterval(this.quiz.timer); this.quiz.timer=setInterval(()=>{this.quiz.time++; let m=Math.floor(this.quiz.time/60).toString().padStart(2,'0'),s=(this.quiz.time%60).toString().padStart(2,'0'); document.getElementById('quiz-timer').innerText=`${m}:${s}`;},1000); this.nextQuizQuestion(); },
            nextQuizQuestion(){ if(this.quiz.current>=this.quiz.total) return this.endQuiz(); this.quiz.current++; document.getElementById('quiz-idx').innerText=this.quiz.current; const t=this.data[Math.floor(Math.random()*this.data.length)]; let o=[t]; while(o.length<4){let w=this.data[Math.floor(Math.random()*this.data.length)]; if(!o.includes(w))o.push(w);} o.sort(()=>Math.random()-0.5); document.getElementById('quiz-container').innerHTML=`<h2 class="text-3xl font-bold text-slate-800 mb-8 text-center">${t.w}</h2><div class="grid gap-3" id="q-opts"></div>`; const div=document.getElementById('q-opts'); o.forEach(opt=>{ const b=document.createElement('button'); b.className="w-full p-4 text-left bg-white border-2 border-slate-100 rounded-xl font-bold text-slate-600 hover:bg-indigo-50"; b.innerText=opt.t; b.onclick=()=>{ Array.from(div.children).forEach(k=>k.disabled=true); if(opt===t){b.className="w-full p-4 bg-emerald-500 text-white rounded-xl font-bold"; this.quiz.score+=10; setTimeout(()=>this.nextQuizQuestion(),600);}else{b.className="w-full p-4 bg-rose-500 text-white rounded-xl font-bold"; setTimeout(()=>this.nextQuizQuestion(),1000);} document.getElementById('quiz-score').innerText=this.quiz.score; }; div.appendChild(b); }); },
            endQuiz(){ clearInterval(this.quiz.timer); this.quiz.history.unshift({date:new Date().toLocaleString(), score:this.quiz.score}); if(this.quiz.history.length>5)this.quiz.history.pop(); this.saveState(); document.getElementById('quiz-container').innerHTML=`<div class="text-center"><h2 class="text-3xl font-bold mb-4">Done!</h2><p class="text-xl mb-6">Score: ${this.quiz.score}</p><button onclick="app.startQuizRun()" class="px-6 py-3 bg-indigo-600 text-white rounded-lg">Again</button></div>`; document.getElementById('quiz-history').classList.remove('hidden'); this.resetQuizUI(); },
            
            speak(e){ e.stopPropagation(); const u=new SpeechSynthesisUtterance(this.data[this.state.index%this.data.length].w); u.lang='en-GB'; window.speechSynthesis.speak(u); },
            resetData(){ if(confirm("Reset?")){localStorage.clear(); location.reload();} },
            renderIcons(){ lucide.createIcons(); }
        };
        window.onload = () => app.init();
    </script>
</body>
</html>